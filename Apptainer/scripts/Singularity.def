Bootstrap: docker
From: continuumio/miniconda3

%post
    
    apt-get update && apt-get install -y wget bzip2 ca-certificates curl git g++

    
    /opt/conda/bin/conda create -n phy_env2 python=3.9 -y
    /opt/conda/bin/conda init bash
    echo "conda activate phy_env2" >> ~/.bashrc

    
    /opt/conda/bin/conda install -n phy_env2 -c defaults -c conda-forge -y \
        numpy \
        pandas \
        matplotlib \
        scikit-learn \
        tqdm \
        networkx \
        einops \
        pytorch \
        torchvision \
        pybind11 \
        -c pytorch

   
    /opt/conda/envs/phy_env2/bin/pip install curtsies
    /opt/conda/envs/phy_env2/bin/pip install torch-cluster==1.6.3
    /opt/conda/envs/phy_env2/bin/pip install torch-geometric==2.5.3
    /opt/conda/envs/phy_env2/bin/pip install torch-scatter==2.1.2
    /opt/conda/envs/phy_env2/bin/pip install torch-sparse==0.6.18

%environment
    
    export PATH=/opt/conda/envs/phy_env2/bin:$PATH
    export CONDA_DEFAULT_ENV=phy_env2

%runscript
    
    exec /bin/bash

%startscript
    
    exec /bin/bash -c "source ~/.bashrc && conda activate phy_env2 && jupyter notebook --notebook-dir=/notebooks --ip 0.0.0.0 --no-browser --allow-root"
